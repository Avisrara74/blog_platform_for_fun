{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\stalk\\\\jm-blog-platform\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _toConsumableArray from\"C:\\\\Users\\\\stalk\\\\jm-blog-platform\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:\\\\Users\\\\stalk\\\\jm-blog-platform\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"C:\\\\Users\\\\stalk\\\\jm-blog-platform\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import axios from'axios';import{uniqueId}from'lodash';import*as routes from'./routes';import{checkFieldErrors,networkErrorCheck,mainRequestHandler}from'./index';axios.interceptors.request.use(function(req){return mainRequestHandler(req);});// получаем список статей частями (подробнее см. redux/actions/articles getArticles)\nexport var getArticles=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(articlesPerRequest,articlesCounter){var localRequestHandler,requestInterceptor,response,_response$data,articles,articlesCount,initialArticlesById,articlesArray;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// counter увеличивается на кол-во полученных статей после каждого вызова функции из экшена\nlocalRequestHandler=function localRequestHandler(req){req.params={limit:articlesPerRequest,offset:articlesCounter};return req;};// инициализируем чтобы удалить после запроса\nrequestInterceptor=axios.interceptors.request.use(function(req){return localRequestHandler(req);});_context.prev=2;_context.next=5;return axios.get(routes.articlesUrl);case 5:response=_context.sent;_response$data=response.data,articles=_response$data.articles,articlesCount=_response$data.articlesCount;initialArticlesById=articles.map(function(el){return _objectSpread(_objectSpread({},el),{},{id:uniqueId(),tagList:el.tagList.map(function(tagName){return{id:uniqueId(),title:tagName};})});});articlesArray=_toConsumableArray(initialArticlesById);// удаляем интерцептор\naxios.interceptors.request.eject(requestInterceptor);return _context.abrupt(\"return\",{articles:articlesArray,articlesCount:articlesCount});case 13:_context.prev=13;_context.t0=_context[\"catch\"](2);networkErrorCheck(_context.t0);throw _context.t0;case 17:case\"end\":return _context.stop();}}},_callee,null,[[2,13]]);}));return function getArticles(_x,_x2){return _ref.apply(this,arguments);};}();// создание поста\nexport var createArticle=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(articleBody,formik){var response,article;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(routes.articlesUrl,articleBody);case 3:response=_context2.sent;article=response.data.article;return _context2.abrupt(\"return\",_objectSpread(_objectSpread({},article),{},{id:uniqueId(),tagList:article.tagList.map(function(tagName){return{id:uniqueId(),title:tagName};})}));case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);networkErrorCheck(_context2.t0);if(_context2.t0.response.status===422){checkFieldErrors(_context2.t0.response.data.errors,formik);}throw _context2.t0;case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function createArticle(_x3,_x4){return _ref2.apply(this,arguments);};}();// запрос 1 поста\n// eslint-disable-next-line consistent-return\nexport var getOneArticle=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(queryParam){var url,response,article;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;url=routes.oneArticleUrl(queryParam);_context3.next=4;return axios.get(url);case 4:response=_context3.sent;article=response.data.article;return _context3.abrupt(\"return\",_objectSpread(_objectSpread({},article),{},{id:uniqueId(),tagList:article.tagList.map(function(tagName){return{id:uniqueId(),title:tagName};})}));case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);networkErrorCheck(_context3.t0);case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[0,9]]);}));return function getOneArticle(_x5){return _ref3.apply(this,arguments);};}();// изменить пост\nexport var editArticle=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(articleBody,queryParam,formik){var url;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;url=routes.oneArticleUrl(queryParam);_context4.next=4;return axios.put(url,articleBody);case 4:_context4.next=10;break;case 6:_context4.prev=6;_context4.t0=_context4[\"catch\"](0);networkErrorCheck(_context4.t0);if(_context4.t0.response.status===422){checkFieldErrors(_context4.t0.response.data.errors,formik);}case 10:case\"end\":return _context4.stop();}}},_callee4,null,[[0,6]]);}));return function editArticle(_x6,_x7,_x8){return _ref4.apply(this,arguments);};}();// лайкнуть пост\n// eslint-disable-next-line consistent-return\nexport var addLike=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(likeBody){var id,slug,favorited,response;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:id=likeBody.id,slug=likeBody.slug,favorited=likeBody.favorited;_context5.prev=1;if(!(favorited===true)){_context5.next=8;break;}_context5.next=5;return axios.delete(routes.changeLikeUrl(slug));case 5:_context5.t0=_context5.sent;_context5.next=11;break;case 8:_context5.next=10;return axios.post(routes.changeLikeUrl(slug));case 10:_context5.t0=_context5.sent;case 11:response=_context5.t0;return _context5.abrupt(\"return\",{isFavorited:response.data.article.favorited,id:id});case 15:_context5.prev=15;_context5.t1=_context5[\"catch\"](1);// eslint-disable-next-line no-console\nconsole.log(_context5.t1.response);case 18:case\"end\":return _context5.stop();}}},_callee5,null,[[1,15]]);}));return function addLike(_x9){return _ref5.apply(this,arguments);};}();// удалить пост\nexport var removeArticle=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(queryParam){var url;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:url=routes.oneArticleUrl(queryParam);_context6.next=3;return axios.delete(url);case 3:case\"end\":return _context6.stop();}}},_callee6);}));return function removeArticle(_x10){return _ref6.apply(this,arguments);};}();","map":{"version":3,"sources":["C:/Users/stalk/jm-blog-platform/src/API/articles.js"],"names":["axios","uniqueId","routes","checkFieldErrors","networkErrorCheck","mainRequestHandler","interceptors","request","use","req","getArticles","articlesPerRequest","articlesCounter","localRequestHandler","params","limit","offset","requestInterceptor","get","articlesUrl","response","data","articles","articlesCount","initialArticlesById","map","el","id","tagList","tagName","title","articlesArray","eject","createArticle","articleBody","formik","post","article","status","errors","getOneArticle","queryParam","url","oneArticleUrl","editArticle","put","addLike","likeBody","slug","favorited","delete","changeLikeUrl","isFavorited","console","log","removeArticle"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport { uniqueId } from 'lodash';\nimport * as routes from './routes';\nimport { checkFieldErrors, networkErrorCheck, mainRequestHandler } from './index';\n\naxios.interceptors.request.use(\n  (req) => mainRequestHandler(req),\n);\n\n// получаем список статей частями (подробнее см. redux/actions/articles getArticles)\nexport const getArticles = async (articlesPerRequest, articlesCounter) => {\n  // counter увеличивается на кол-во полученных статей после каждого вызова функции из экшена\n  const localRequestHandler = (req) => {\n    req.params = { limit: articlesPerRequest, offset: articlesCounter };\n    return req;\n  };\n\n  // инициализируем чтобы удалить после запроса\n  const requestInterceptor = axios.interceptors.request.use(\n    (req) => localRequestHandler(req),\n  );\n\n  try {\n    const response = await axios.get(routes.articlesUrl);\n\n    const { articles, articlesCount } = response.data;\n\n    const initialArticlesById = articles.map((el) => ({\n      ...el,\n      id: uniqueId(),\n      tagList: el.tagList.map((tagName) => ({ id: uniqueId(), title: tagName })),\n    }));\n    const articlesArray = [...initialArticlesById];\n\n    // удаляем интерцептор\n    axios.interceptors.request.eject(requestInterceptor);\n\n    return {\n      articles: articlesArray,\n      articlesCount,\n    };\n  } catch (error) {\n    networkErrorCheck(error);\n    throw error;\n  }\n};\n\n// создание поста\nexport const createArticle = async (articleBody, formik) => {\n  try {\n    const response = await axios.post(routes.articlesUrl, articleBody);\n\n    const { article } = response.data;\n\n    return {\n      ...article,\n      id: uniqueId(),\n      tagList: article.tagList.map((tagName) => ({ id: uniqueId(), title: tagName })),\n    };\n  } catch (error) {\n    networkErrorCheck(error);\n    if (error.response.status === 422) {\n      checkFieldErrors(error.response.data.errors, formik);\n    }\n    throw error;\n  }\n};\n\n// запрос 1 поста\n// eslint-disable-next-line consistent-return\nexport const getOneArticle = async (queryParam) => {\n  try {\n    const url = routes.oneArticleUrl(queryParam);\n    const response = await axios.get(url);\n\n    const { article } = response.data;\n\n    return {\n      ...article,\n      id: uniqueId(),\n      tagList: article.tagList.map((tagName) => ({ id: uniqueId(), title: tagName })),\n    };\n  } catch (error) {\n    networkErrorCheck(error);\n  }\n};\n\n// изменить пост\nexport const editArticle = async (articleBody, queryParam, formik) => {\n  try {\n    const url = routes.oneArticleUrl(queryParam);\n    await axios.put(url, articleBody);\n  } catch (error) {\n    networkErrorCheck(error);\n    if (error.response.status === 422) {\n      checkFieldErrors(error.response.data.errors, formik);\n    }\n  }\n};\n\n// лайкнуть пост\n// eslint-disable-next-line consistent-return\nexport const addLike = async (likeBody) => {\n  const { id, slug, favorited } = likeBody;\n  try {\n    // лайк или дизлайк в зависимости от текущего состояния\n    const response = (favorited === true)\n      ? await axios.delete(routes.changeLikeUrl(slug))\n      : await axios.post(routes.changeLikeUrl(slug));\n\n    return {\n      isFavorited: response.data.article.favorited,\n      id,\n    };\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.log(error.response);\n  }\n};\n\n// удалить пост\nexport const removeArticle = async (queryParam) => {\n  const url = routes.oneArticleUrl(queryParam);\n  await axios.delete(url);\n};\n"]},"metadata":{},"sourceType":"module"}