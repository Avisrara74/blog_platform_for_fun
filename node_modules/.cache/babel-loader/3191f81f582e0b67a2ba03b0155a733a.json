{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\stalk\\\\jm-blog-platform\\\\src\\\\components\\\\articles-list\\\\article.js\";\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport { getDate } from '../../helper';\nimport * as actions from '../../redux/actions';\nimport { ArtickesLikeImg, ArticlesDate, ArticlesDescription, ArticlesHeader, ArticlesInfo, ArticlesItem, ArticlesLikesCount, ArticlesStats, ArticlesTag, ArticlesTagsWrap, articlesTitle, ArticlesUserImage, ArticlesUserInfoWrap, ArticlesUserInfoGroup, ArticlesUsername } from '../../styled-components';\nimport { articleUrl } from '../../routes';\nimport activeLikeSrc from \"../../images/like-active.svg\";\nimport disabledLikeSrc from \"../../images/like-disabled.svg\";\n\nconst mapStateToProps = state => {\n  const {\n    likeState,\n    addLikeRequestState\n  } = state;\n  console.log(state);\n  const isLikeChangedOnServer = addLikeRequestState === 'finished';\n  const isLikeChangeAlreadyRequested = addLikeRequestState === 'requested';\n  return {\n    likeState,\n    isLikeChangedOnServer,\n    isLikeChangeAlreadyRequested\n  };\n};\n\nconst actionCreator = {\n  addLike: actions.addLike\n};\n\nconst Article = props => {\n  const {\n    articles,\n    fakeLikes,\n    setFakeLikes,\n    likeState,\n    isLikeChangedOnServer,\n    isLikeChangeAlreadyRequested,\n    addLike\n  } = props;\n  return articles.map(article => {\n    const {\n      author,\n      createdAt,\n      description,\n      favorited,\n      id,\n      tagList,\n      title,\n      slug\n    } = article;\n    const {\n      username,\n      image\n    } = author;\n    const dateDiff = getDate(createdAt);\n\n    const renderTagList = () => tagList.map(tag => /*#__PURE__*/React.createElement(ArticlesTag, {\n      key: tag.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 28\n      }\n    }, tag.title)); // визуальное изменение лайка для пользователя\n\n\n    const getFakeLike = () => {\n      if (fakeLikes === undefined) return null;\n      return fakeLikes.filter(el => el.id === id)[0];\n    }; // рендер лайка\n\n\n    const fakeLikeSrc = () => {\n      if (getFakeLike() === undefined) return disabledLikeSrc;\n      return getFakeLike().isLiked ? activeLikeSrc : disabledLikeSrc;\n    }; // рендер счетчика лайков\n\n\n    const fakeLikeCounter = () => {\n      if (getFakeLike() === undefined) return 0;\n      return getFakeLike().likesCount;\n    };\n    /*\n        1) пользователь нажимает на фейк-лайк\n        2) отправляется запрос на сервер с измененным фейк-состоянием\n           если пользователь нажимает на лайк пока запрос идет, то повторный запрос не отправляется\n        3) приходит ответ с изменённым состоянием\n           после ответа проверяем, состояние фейк-лайка такое же как и у обновлённого состояния?\n           если да, то оставляем всё как есть\n           если нет, то снова отправляем запрос на сервер\n    */\n\n\n    const handleOnLikeArticle = () => {\n      setFakeLikes(state => {\n        const newState = state.map(el => {\n          if (el.id === id) {\n            return { ...el,\n              isLiked: !el.isLiked,\n              likesCount: el.isLiked ? el.likesCount - 1 : el.likesCount + 1\n            };\n          }\n\n          return el;\n        });\n        return newState;\n      }); // все еще идет прошлый запрос на изменение лайка\n\n      if (isLikeChangeAlreadyRequested) return false; // отправляем новый\n\n      if (likeState !== getFakeLike().isLiked) {\n        addLike(getFakeLike().isLiked, slug);\n      }\n\n      ;\n    };\n\n    return /*#__PURE__*/React.createElement(ArticlesItem, {\n      key: id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(ArticlesInfo, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ArticlesHeader, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      style: articlesTitle,\n      to: articleUrl(slug),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 13\n      }\n    }, title), /*#__PURE__*/React.createElement(ArticlesStats, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(ArtickesLikeImg, {\n      onClick: handleOnLikeArticle,\n      src: fakeLikeSrc(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(ArticlesLikesCount, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 15\n      }\n    }, fakeLikeCounter()))), /*#__PURE__*/React.createElement(ArticlesTagsWrap, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 11\n      }\n    }, renderTagList()), /*#__PURE__*/React.createElement(ArticlesDescription, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 11\n      }\n    }, description)), /*#__PURE__*/React.createElement(ArticlesUserInfoWrap, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ArticlesUserInfoGroup, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(ArticlesUsername, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 13\n      }\n    }, username), /*#__PURE__*/React.createElement(ArticlesDate, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 13\n      }\n    }, dateDiff)), /*#__PURE__*/React.createElement(ArticlesUserImage, {\n      src: image,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 11\n      }\n    })));\n  });\n};\n\nexport default connect(mapStateToProps, actionCreator)(Article);","map":{"version":3,"sources":["C:/Users/stalk/jm-blog-platform/src/components/articles-list/article.js"],"names":["React","connect","Link","getDate","actions","ArtickesLikeImg","ArticlesDate","ArticlesDescription","ArticlesHeader","ArticlesInfo","ArticlesItem","ArticlesLikesCount","ArticlesStats","ArticlesTag","ArticlesTagsWrap","articlesTitle","ArticlesUserImage","ArticlesUserInfoWrap","ArticlesUserInfoGroup","ArticlesUsername","articleUrl","mapStateToProps","state","likeState","addLikeRequestState","console","log","isLikeChangedOnServer","isLikeChangeAlreadyRequested","actionCreator","addLike","Article","props","articles","fakeLikes","setFakeLikes","map","article","author","createdAt","description","favorited","id","tagList","title","slug","username","image","dateDiff","renderTagList","tag","getFakeLike","undefined","filter","el","fakeLikeSrc","disabledLikeSrc","isLiked","activeLikeSrc","fakeLikeCounter","likesCount","handleOnLikeArticle","newState"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport { getDate } from '../../helper';\nimport * as actions from '../../redux/actions';\nimport {\n  ArtickesLikeImg, ArticlesDate, ArticlesDescription,\n  ArticlesHeader,\n  ArticlesInfo, ArticlesItem, ArticlesLikesCount,\n  ArticlesStats,\n  ArticlesTag, ArticlesTagsWrap,\n  articlesTitle, ArticlesUserImage, ArticlesUserInfoWrap, ArticlesUserInfoGroup, ArticlesUsername,\n} from '../../styled-components';\nimport { articleUrl } from '../../routes';\nimport activeLikeSrc from '../../images/like-active.svg';\nimport disabledLikeSrc from '../../images/like-disabled.svg';\n\nconst mapStateToProps = (state) => {\n  const { likeState, addLikeRequestState } = state;\n  console.log(state);\n\n  const isLikeChangedOnServer = addLikeRequestState === 'finished';\n  const isLikeChangeAlreadyRequested = addLikeRequestState === 'requested';\n\n  return { likeState, isLikeChangedOnServer, isLikeChangeAlreadyRequested };\n};\n\nconst actionCreator = {\n  addLike: actions.addLike,\n};\n\nconst Article = (props) => {\n  const {\n    articles, fakeLikes, setFakeLikes, likeState, isLikeChangedOnServer, isLikeChangeAlreadyRequested, addLike,\n  } = props;\n\n  return articles.map((article) => {\n    const {\n      author, createdAt, description, favorited, id, tagList, title, slug,\n    } = article;\n    const { username, image } = author;\n    const dateDiff = getDate(createdAt);\n\n    const renderTagList = () => (\n      tagList.map((tag) => <ArticlesTag key={tag.id}>{tag.title}</ArticlesTag>)\n    );\n\n    // визуальное изменение лайка для пользователя\n    const getFakeLike = () => {\n      if (fakeLikes === undefined) return null;\n      return fakeLikes.filter((el) => el.id === id)[0];\n    };\n\n    // рендер лайка\n    const fakeLikeSrc = () => {\n      if (getFakeLike() === undefined) return disabledLikeSrc;\n      return getFakeLike().isLiked ? activeLikeSrc : disabledLikeSrc;\n    };\n\n    // рендер счетчика лайков\n    const fakeLikeCounter = () => {\n      if (getFakeLike() === undefined) return 0;\n      return getFakeLike().likesCount;\n    };\n    /*\n        1) пользователь нажимает на фейк-лайк\n        2) отправляется запрос на сервер с измененным фейк-состоянием\n           если пользователь нажимает на лайк пока запрос идет, то повторный запрос не отправляется\n        3) приходит ответ с изменённым состоянием\n           после ответа проверяем, состояние фейк-лайка такое же как и у обновлённого состояния?\n           если да, то оставляем всё как есть\n           если нет, то снова отправляем запрос на сервер\n    */\n    const handleOnLikeArticle = () => {\n      setFakeLikes((state) => {\n        const newState = state.map((el) => {\n          if (el.id === id) {\n            return {\n              ...el,\n              isLiked: !el.isLiked,\n              likesCount: (el.isLiked) ? el.likesCount - 1 : el.likesCount + 1,\n            };\n          }\n          return el;\n        });\n        return newState;\n      });\n\n      // все еще идет прошлый запрос на изменение лайка\n      if (isLikeChangeAlreadyRequested) return false;\n\n      // отправляем новый\n      if (likeState !== getFakeLike().isLiked) {\n        addLike(getFakeLike().isLiked, slug);\n      };\n    };\n\n    return (\n      <ArticlesItem key={id}>\n        <ArticlesInfo>\n          <ArticlesHeader>\n            <Link style={articlesTitle} to={articleUrl(slug)}>\n              {title}\n            </Link>\n            <ArticlesStats>\n              <ArtickesLikeImg\n                onClick={handleOnLikeArticle}\n                src={fakeLikeSrc()}\n              />\n              <ArticlesLikesCount>{fakeLikeCounter()}</ArticlesLikesCount>\n            </ArticlesStats>\n          </ArticlesHeader>\n          <ArticlesTagsWrap>\n            {renderTagList()}\n          </ArticlesTagsWrap>\n\n          <ArticlesDescription>\n            {description}\n          </ArticlesDescription>\n        </ArticlesInfo>\n\n        <ArticlesUserInfoWrap>\n          <ArticlesUserInfoGroup>\n            <ArticlesUsername>{username}</ArticlesUsername>\n            <ArticlesDate>{dateDiff}</ArticlesDate>\n          </ArticlesUserInfoGroup>\n          <ArticlesUserImage src={image} />\n        </ArticlesUserInfoWrap>\n      </ArticlesItem>\n    );\n  });\n};\n\nexport default connect(mapStateToProps, actionCreator)(Article);\n"]},"metadata":{},"sourceType":"module"}