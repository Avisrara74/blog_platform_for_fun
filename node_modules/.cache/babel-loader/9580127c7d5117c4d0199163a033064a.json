{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\stalk\\\\jm-blog-platform\\\\src\\\\components\\\\articles-list\\\\article.js\";\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport { getDate } from '../../helper';\nimport * as actions from '../../redux/actions';\nimport { ArtickesLikeImg, ArticlesDate, ArticlesDescription, ArticlesHeader, ArticlesInfo, ArticlesItem, ArticlesLikesCount, ArticlesStats, ArticlesTag, ArticlesTagsWrap, ArticlesHeaderTitle, ArticlesUserImage, ArticlesUserInfoWrap, ArticlesUserInfoGroup, ArticlesUsername } from '../../styled-components';\nimport { articleUrl } from '../../routes';\nimport activeLikeSrc from \"../../images/like-active.svg\";\nimport disabledLikeSrc from \"../../images/like-disabled.svg\";\nconst linkStyles = {\n  textDecoration: 'none',\n  color: 'rgba(0, 0, 0, 0.75)'\n};\n\nconst mapStateToProps = state => {\n  const {\n    likesStateOnServer,\n    addLikeRequestState\n  } = state;\n  const isLikeChangedOnServer = addLikeRequestState === 'finished';\n  console.log(state);\n  return {\n    likesStateOnServer,\n    isLikeChangedOnServer,\n    addLikeRequestState\n  };\n};\n\nconst actionCreator = {\n  addLike: actions.addLike\n};\n\nconst Article = props => {\n  const {\n    articles,\n    likesStateOnServer,\n    addLike,\n    addLikeRequestState\n  } = props;\n\n  const handleOnLikeArticle = (event, articleLikeInfo) => {\n    event.preventDefault();\n    event.stopPropagation();\n    const isCurrentLikeRequested = addLikeRequestState.some(el => el === articleLikeInfo.id);\n\n    if (isCurrentLikeRequested) {\n      const rejectRequest = { ...articleLikeInfo,\n        isAlreadyRequested: true\n      };\n      console.log('отправка запрещена');\n      return addLike(rejectRequest);\n    }\n\n    return addLike(articleLikeInfo);\n  };\n\n  const repeatChangeLikeRequest = () => {\n    const newLikesState = likesStateOnServer.map(serverLikeState => {\n      const findEl = articles.find(article => article.id === serverLikeState.id); // объединить фейковые лайки и те которые пришли от сервера в один объект\n      // для удобного сравнения\n\n      if (findEl) {\n        return {\n          id: findEl.id,\n          slug: findEl.slug,\n          favorited: findEl.favorited,\n          isLikedOnServer: serverLikeState.isFavorited\n        };\n      }\n\n      return serverLikeState;\n    });\n    const isDiff = newLikesState.find(el => el.favorited !== el.isLikedOnServer);\n    console.log(isDiff);\n    if (isDiff !== undefined) handleOnLikeArticle(null, isDiff);\n  };\n\n  useEffect(() => {\n    repeatChangeLikeRequest();\n  }, [articles]);\n\n  const renderArticle = () => articles.map(article => {\n    const {\n      author,\n      createdAt,\n      description,\n      id,\n      tagList,\n      title,\n      slug,\n      favorited,\n      favoritesCount\n    } = article;\n    const {\n      username,\n      image\n    } = author;\n    const dateDiff = getDate(createdAt);\n\n    const renderTagList = () => tagList.map(tag => /*#__PURE__*/React.createElement(ArticlesTag, {\n      key: tag.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 28\n      }\n    }, tag.title));\n\n    const isLiked = favorited ? activeLikeSrc : disabledLikeSrc;\n    const articleLikeInfo = {\n      id,\n      favorited,\n      slug,\n      isAlreadyRequested: false\n    };\n    /*\n    1) пользователь нажимает на фейк-лайк\n    2) отправляется запрос на сервер с измененным фейк-состоянием\n       если пользователь нажимает на лайк пока запрос идет, то повторный запрос не отправляется\n    3) приходит ответ с изменённым состоянием\n       после ответа проверяем, состояние фейк-лайка такое же как и у обновлённого состояния?\n       если да, то оставляем всё как есть\n       если нет, то снова отправляем запрос на сервер\n      */\n\n    return /*#__PURE__*/React.createElement(Link, {\n      to: articleUrl(slug),\n      style: linkStyles,\n      key: id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(ArticlesItem, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ArticlesInfo, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(ArticlesHeader, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(ArticlesHeaderTitle, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 15\n      }\n    }, title), /*#__PURE__*/React.createElement(ArticlesStats, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ArtickesLikeImg, {\n      onClick: event => handleOnLikeArticle(event, articleLikeInfo),\n      src: isLiked,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(ArticlesLikesCount, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 17\n      }\n    }, favoritesCount))), /*#__PURE__*/React.createElement(ArticlesTagsWrap, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 13\n      }\n    }, renderTagList()), /*#__PURE__*/React.createElement(ArticlesDescription, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 13\n      }\n    }, description)), /*#__PURE__*/React.createElement(ArticlesUserInfoWrap, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(ArticlesUserInfoGroup, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(ArticlesUsername, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 15\n      }\n    }, username), /*#__PURE__*/React.createElement(ArticlesDate, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 15\n      }\n    }, dateDiff)), /*#__PURE__*/React.createElement(ArticlesUserImage, {\n      src: image,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 13\n      }\n    }))));\n  });\n\n  return renderArticle();\n};\n\nexport default connect(mapStateToProps, actionCreator)(Article);","map":{"version":3,"sources":["C:/Users/stalk/jm-blog-platform/src/components/articles-list/article.js"],"names":["React","useEffect","useState","connect","Link","getDate","actions","ArtickesLikeImg","ArticlesDate","ArticlesDescription","ArticlesHeader","ArticlesInfo","ArticlesItem","ArticlesLikesCount","ArticlesStats","ArticlesTag","ArticlesTagsWrap","ArticlesHeaderTitle","ArticlesUserImage","ArticlesUserInfoWrap","ArticlesUserInfoGroup","ArticlesUsername","articleUrl","linkStyles","textDecoration","color","mapStateToProps","state","likesStateOnServer","addLikeRequestState","isLikeChangedOnServer","console","log","actionCreator","addLike","Article","props","articles","handleOnLikeArticle","event","articleLikeInfo","preventDefault","stopPropagation","isCurrentLikeRequested","some","el","id","rejectRequest","isAlreadyRequested","repeatChangeLikeRequest","newLikesState","map","serverLikeState","findEl","find","article","slug","favorited","isLikedOnServer","isFavorited","isDiff","undefined","renderArticle","author","createdAt","description","tagList","title","favoritesCount","username","image","dateDiff","renderTagList","tag","isLiked","activeLikeSrc","disabledLikeSrc"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport { getDate } from '../../helper';\nimport * as actions from '../../redux/actions';\nimport {\n  ArtickesLikeImg, ArticlesDate, ArticlesDescription,\n  ArticlesHeader,\n  ArticlesInfo, ArticlesItem, ArticlesLikesCount,\n  ArticlesStats,\n  ArticlesTag, ArticlesTagsWrap,\n  ArticlesHeaderTitle, ArticlesUserImage,\n  ArticlesUserInfoWrap, ArticlesUserInfoGroup, ArticlesUsername,\n} from '../../styled-components';\nimport { articleUrl } from '../../routes';\nimport activeLikeSrc from '../../images/like-active.svg';\nimport disabledLikeSrc from '../../images/like-disabled.svg';\n\nconst linkStyles = {\n  textDecoration: 'none',\n  color: 'rgba(0, 0, 0, 0.75)',\n};\nconst mapStateToProps = (state) => {\n  const { likesStateOnServer, addLikeRequestState } = state;\n\n  const isLikeChangedOnServer = addLikeRequestState === 'finished';\n\n  console.log(state);\n  return { likesStateOnServer, isLikeChangedOnServer, addLikeRequestState };\n};\n\nconst actionCreator = {\n  addLike: actions.addLike,\n};\n\nconst Article = (props) => {\n  const {\n    articles, likesStateOnServer,\n    addLike, addLikeRequestState,\n  } = props;\n\n  const handleOnLikeArticle = (event, articleLikeInfo) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const isCurrentLikeRequested = addLikeRequestState.some((el) => el === articleLikeInfo.id);\n    if (isCurrentLikeRequested) {\n      const rejectRequest = { ...articleLikeInfo, isAlreadyRequested: true };\n      console.log('отправка запрещена');\n      return addLike(rejectRequest);\n    }\n\n    return addLike(articleLikeInfo);\n  };\n\n  const repeatChangeLikeRequest = () => {\n    const newLikesState = likesStateOnServer.map((serverLikeState) => {\n      const findEl = articles.find((article) => article.id === serverLikeState.id);\n\n      // объединить фейковые лайки и те которые пришли от сервера в один объект\n      // для удобного сравнения\n      if (findEl) {\n        return {\n          id: findEl.id,\n          slug: findEl.slug,\n          favorited: findEl.favorited,\n          isLikedOnServer: serverLikeState.isFavorited,\n        };\n      }\n      return serverLikeState;\n    });\n\n    const isDiff = newLikesState.find((el) => el.favorited !== el.isLikedOnServer);\n\n    console.log(isDiff);\n    if (isDiff !== undefined) handleOnLikeArticle(null, isDiff);\n  }\n\n  useEffect(() => {\n    repeatChangeLikeRequest();\n  }, [articles]);\n\n  const renderArticle = () => articles.map((article) => {\n    const {\n      author, createdAt, description, id, tagList, title, slug, favorited, favoritesCount\n    } = article;\n    const { username, image } = author;\n    const dateDiff = getDate(createdAt);\n\n    const renderTagList = () => (\n      tagList.map((tag) => <ArticlesTag key={tag.id}>{tag.title}</ArticlesTag>)\n    );\n\n    const isLiked = favorited ? activeLikeSrc : disabledLikeSrc;\n\n    const articleLikeInfo = {\n      id,\n      favorited,\n      slug,\n      isAlreadyRequested: false,\n    };\n\n    /*\n    1) пользователь нажимает на фейк-лайк\n    2) отправляется запрос на сервер с измененным фейк-состоянием\n       если пользователь нажимает на лайк пока запрос идет, то повторный запрос не отправляется\n    3) приходит ответ с изменённым состоянием\n       после ответа проверяем, состояние фейк-лайка такое же как и у обновлённого состояния?\n       если да, то оставляем всё как есть\n       если нет, то снова отправляем запрос на сервер\n      */\n\n    return (\n      <Link to={articleUrl(slug)} style={linkStyles} key={id}>\n        <ArticlesItem>\n          <ArticlesInfo>\n            <ArticlesHeader>\n              <ArticlesHeaderTitle>\n                {title}\n              </ArticlesHeaderTitle>\n              <ArticlesStats>\n                <ArtickesLikeImg\n                  onClick={(event) => handleOnLikeArticle(event, articleLikeInfo)}\n                  src={isLiked}\n                />\n                <ArticlesLikesCount>{favoritesCount}</ArticlesLikesCount>\n              </ArticlesStats>\n            </ArticlesHeader>\n            <ArticlesTagsWrap>\n              {renderTagList()}\n            </ArticlesTagsWrap>\n\n            <ArticlesDescription>\n              {description}\n            </ArticlesDescription>\n          </ArticlesInfo>\n\n          <ArticlesUserInfoWrap>\n            <ArticlesUserInfoGroup>\n              <ArticlesUsername>{username}</ArticlesUsername>\n              <ArticlesDate>{dateDiff}</ArticlesDate>\n            </ArticlesUserInfoGroup>\n            <ArticlesUserImage src={image} />\n          </ArticlesUserInfoWrap>\n        </ArticlesItem>\n      </Link>\n    );\n  });\n\n  return renderArticle();\n};\n\nexport default connect(mapStateToProps, actionCreator)(Article);\n"]},"metadata":{},"sourceType":"module"}