{"ast":null,"code":"import React,{useEffect}from'react';import{Link,useParams}from'react-router-dom';import{connect}from'react-redux';import ReactMarkdown from'react-markdown';import{ExclamationCircleOutlined}from'@ant-design/icons';import{Modal}from'antd';import{useHistory}from'react-router';import*as actions from'../../redux/actions/articles';import{editArticleUrl,mainUrl}from'../../routes';import disabledLikeSrc from\"../../images/like-disabled.svg\";import activeLikeSrc from\"../../images/like-active.svg\";import{renderLoader,getDate}from'../../helper';import{ArticlesLikeImg,ArticlesDate,ArticlesDescription,ArticlesHeader,ArticlesInfo,ArticlesLikesCount,ArticlesStats,ArticlesTag,ArticlesTagsWrap,ArticlesHeaderTitle,ArticlesUserImage,ArticlesUserInfo,ArticlesUserInfoGroup,ArticlesUsername,ArticleAuthorOptions,ArticleDeleteButton,ArticleEditButton,ArticleUserInfoWrap,ArticleWrapper,ArticleHeader,ArticleBody}from'../../styled-components';var mapStateToProps=function mapStateToProps(state){var articles=state.articles,userData=state.userData,oneArticle=state.oneArticle,oneArticleState=state.oneArticleState,removeArticleState=state.removeArticleState;return{articles:articles,username:userData.username,isOneArticleReady:oneArticleState==='finished',isArticleRemoved:removeArticleState==='finished',oneArticle:oneArticle,removeArticleState:removeArticleState};};var actionCreator={getOneArticle:actions.getOneArticle,removeArticle:actions.removeArticle};var Article=function Article(props){var articles=props.articles,username=props.username,getOneArticle=props.getOneArticle,oneArticle=props.oneArticle,isOneArticleReady=props.isOneArticleReady,removeArticle=props.removeArticle,isArticleRemoved=props.isArticleRemoved;var _useParams=useParams(),slug=_useParams.slug;var validSlug=slug.slice(1,slug.length);var history=useHistory();var redirectToHome=function redirectToHome(){history.push(mainUrl);};useEffect(function(){// если нету уже загруженного массива постов то получаем один\nif(articles.length===0){getOneArticle(validSlug);}if(isArticleRemoved){redirectToHome();}},[isArticleRemoved]);var handleOnDeleteArticle=function handleOnDeleteArticle(){var confirm=Modal.confirm;confirm({title:'Are you sure to delete this article?',icon:/*#__PURE__*/React.createElement(ExclamationCircleOutlined,null),onOk:function onOk(){removeArticle(validSlug);}});};var renderArticle=function renderArticle(data){var article;// если пользователь переходит по URL, то грузим нужный article с сервера\nif(!Array.isArray(data)){if(!isOneArticleReady)return renderLoader();article=data;}// если по ссылке со списка артайклов, то берем из массива нужный\nif(Array.isArray(data)){article=data.find(function(el){return el.slug===validSlug;});}var _article=article,author=_article.author,createdAt=_article.createdAt,description=_article.description,favoritesCount=_article.favoritesCount,favorited=_article.favorited,tagList=_article.tagList,title=_article.title,body=_article.body;var isCurrentUserAuthor=username===author.username;var dateDiff=getDate(createdAt);var renderTagList=function renderTagList(){return tagList.map(function(tag){return/*#__PURE__*/React.createElement(ArticlesTag,{key:tag.id},tag.title);});};var renderAuthorOptions=function renderAuthorOptions(){if(!isCurrentUserAuthor)return false;return/*#__PURE__*/React.createElement(ArticleAuthorOptions,null,/*#__PURE__*/React.createElement(ArticleDeleteButton,{onClick:handleOnDeleteArticle},\"Delete\"),/*#__PURE__*/React.createElement(Link,{to:editArticleUrl(validSlug)},/*#__PURE__*/React.createElement(ArticleEditButton,null,\"Edit\")));};return/*#__PURE__*/React.createElement(ArticleWrapper,null,/*#__PURE__*/React.createElement(ArticleHeader,null,/*#__PURE__*/React.createElement(ArticlesInfo,null,/*#__PURE__*/React.createElement(ArticlesHeader,null,/*#__PURE__*/React.createElement(ArticlesHeaderTitle,null,title),/*#__PURE__*/React.createElement(ArticlesStats,null,/*#__PURE__*/React.createElement(ArticlesLikeImg,{src:favorited?activeLikeSrc:disabledLikeSrc}),/*#__PURE__*/React.createElement(ArticlesLikesCount,null,favoritesCount))),/*#__PURE__*/React.createElement(ArticlesTagsWrap,null,renderTagList()),/*#__PURE__*/React.createElement(ArticlesDescription,null,description)),/*#__PURE__*/React.createElement(ArticleUserInfoWrap,null,/*#__PURE__*/React.createElement(ArticlesUserInfo,null,/*#__PURE__*/React.createElement(ArticlesUserInfoGroup,null,/*#__PURE__*/React.createElement(ArticlesUsername,null,author.username),/*#__PURE__*/React.createElement(ArticlesDate,null,dateDiff)),/*#__PURE__*/React.createElement(ArticlesUserImage,{src:author.image})),renderAuthorOptions())),/*#__PURE__*/React.createElement(ArticleBody,null,/*#__PURE__*/React.createElement(ReactMarkdown,{source:body})));};return articles.length===0?renderArticle(oneArticle):renderArticle(articles);};export default connect(mapStateToProps,actionCreator)(Article);","map":{"version":3,"sources":["C:/Users/stalk/jm-blog-platform/src/components/article/index.js"],"names":["React","useEffect","Link","useParams","connect","ReactMarkdown","ExclamationCircleOutlined","Modal","useHistory","actions","editArticleUrl","mainUrl","renderLoader","getDate","ArticlesLikeImg","ArticlesDate","ArticlesDescription","ArticlesHeader","ArticlesInfo","ArticlesLikesCount","ArticlesStats","ArticlesTag","ArticlesTagsWrap","ArticlesHeaderTitle","ArticlesUserImage","ArticlesUserInfo","ArticlesUserInfoGroup","ArticlesUsername","ArticleAuthorOptions","ArticleDeleteButton","ArticleEditButton","ArticleUserInfoWrap","ArticleWrapper","ArticleHeader","ArticleBody","mapStateToProps","state","articles","userData","oneArticle","oneArticleState","removeArticleState","username","isOneArticleReady","isArticleRemoved","actionCreator","getOneArticle","removeArticle","Article","props","slug","validSlug","slice","length","history","redirectToHome","push","handleOnDeleteArticle","confirm","title","icon","onOk","renderArticle","data","article","Array","isArray","find","el","author","createdAt","description","favoritesCount","favorited","tagList","body","isCurrentUserAuthor","dateDiff","renderTagList","map","tag","id","renderAuthorOptions","activeLikeSrc","disabledLikeSrc","image"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport { Link, useParams } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport ReactMarkdown from 'react-markdown';\nimport { ExclamationCircleOutlined } from '@ant-design/icons';\nimport { Modal } from 'antd';\nimport { useHistory } from 'react-router';\nimport * as actions from '../../redux/actions/articles';\nimport { editArticleUrl, mainUrl } from '../../routes';\nimport disabledLikeSrc from '../../images/like-disabled.svg';\nimport activeLikeSrc from '../../images/like-active.svg';\nimport { renderLoader, getDate } from '../../helper';\n\nimport {\n  ArticlesLikeImg, ArticlesDate, ArticlesDescription,\n  ArticlesHeader,\n  ArticlesInfo, ArticlesLikesCount,\n  ArticlesStats, ArticlesTag, ArticlesTagsWrap,\n  ArticlesHeaderTitle, ArticlesUserImage, ArticlesUserInfo, ArticlesUserInfoGroup, ArticlesUsername,\n  ArticleAuthorOptions, ArticleDeleteButton, ArticleEditButton, ArticleUserInfoWrap,\n  ArticleWrapper, ArticleHeader, ArticleBody,\n} from '../../styled-components';\n\nconst mapStateToProps = (state) => {\n  const {\n    articles, userData, oneArticle, oneArticleState, removeArticleState,\n  } = state;\n\n  return {\n    articles,\n    username: userData.username,\n    isOneArticleReady: (oneArticleState === 'finished'),\n    isArticleRemoved: (removeArticleState === 'finished'),\n    oneArticle,\n    removeArticleState,\n  };\n};\n\nconst actionCreator = {\n  getOneArticle: actions.getOneArticle,\n  removeArticle: actions.removeArticle,\n};\n\nconst Article = (props) => {\n  const {\n    articles, username, getOneArticle,\n    oneArticle, isOneArticleReady, removeArticle, isArticleRemoved,\n  } = props;\n  const { slug } = useParams();\n  const validSlug = slug.slice(1, slug.length);\n\n  const history = useHistory();\n  const redirectToHome = () => {\n    history.push(mainUrl);\n  };\n\n  useEffect(() => {\n    // если нету уже загруженного массива постов то получаем один\n    if (articles.length === 0) {\n      getOneArticle(validSlug);\n    }\n    if (isArticleRemoved) {\n      redirectToHome();\n    }\n  }, [isArticleRemoved]);\n\n  const handleOnDeleteArticle = () => {\n    const { confirm } = Modal;\n    confirm({\n      title: 'Are you sure to delete this article?',\n      icon: <ExclamationCircleOutlined />,\n      onOk() {\n        removeArticle(validSlug);\n      },\n    });\n  };\n\n  const renderArticle = (data) => {\n    let article;\n\n    // если пользователь переходит по URL, то грузим нужный article с сервера\n    if (!Array.isArray(data)) {\n      if (!isOneArticleReady) return renderLoader();\n      article = data;\n    }\n\n    // если по ссылке со списка артайклов, то берем из массива нужный\n    if (Array.isArray(data)) {\n      article = data.find((el) => el.slug === validSlug);\n    }\n\n    const {\n      author, createdAt, description, favoritesCount, favorited, tagList, title, body,\n    } = article;\n    const isCurrentUserAuthor = (username === author.username);\n\n    const dateDiff = getDate(createdAt);\n\n    const renderTagList = () => (\n      tagList.map((tag) => <ArticlesTag key={tag.id}>{tag.title}</ArticlesTag>)\n    );\n\n    const renderAuthorOptions = () => {\n      if (!isCurrentUserAuthor) return false;\n      return (\n        <ArticleAuthorOptions>\n          <ArticleDeleteButton onClick={handleOnDeleteArticle}>Delete</ArticleDeleteButton>\n          <Link to={editArticleUrl(validSlug)}>\n            <ArticleEditButton>Edit</ArticleEditButton>\n          </Link>\n        </ArticleAuthorOptions>\n      );\n    };\n\n    return (\n      <ArticleWrapper>\n        <ArticleHeader>\n          <ArticlesInfo>\n            <ArticlesHeader>\n              <ArticlesHeaderTitle>\n                {title}\n              </ArticlesHeaderTitle>\n              <ArticlesStats>\n                <ArticlesLikeImg src={favorited ? activeLikeSrc : disabledLikeSrc} />\n                <ArticlesLikesCount>{favoritesCount}</ArticlesLikesCount>\n              </ArticlesStats>\n            </ArticlesHeader>\n            <ArticlesTagsWrap>\n              {renderTagList()}\n            </ArticlesTagsWrap>\n\n            <ArticlesDescription>\n              {description}\n            </ArticlesDescription>\n          </ArticlesInfo>\n\n          <ArticleUserInfoWrap>\n            <ArticlesUserInfo>\n              <ArticlesUserInfoGroup>\n                <ArticlesUsername>{author.username}</ArticlesUsername>\n                <ArticlesDate>{dateDiff}</ArticlesDate>\n              </ArticlesUserInfoGroup>\n              <ArticlesUserImage src={author.image} />\n            </ArticlesUserInfo>\n            {renderAuthorOptions()}\n          </ArticleUserInfoWrap>\n        </ArticleHeader>\n\n        <ArticleBody>\n          <ReactMarkdown\n            source={body}\n          />\n        </ArticleBody>\n      </ArticleWrapper>\n    );\n  };\n\n  return (articles.length === 0) ? renderArticle(oneArticle) : renderArticle(articles);\n};\n\nexport default connect(mapStateToProps, actionCreator)(Article);\n"]},"metadata":{},"sourceType":"module"}