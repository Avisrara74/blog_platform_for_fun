{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\stalk\\\\jm-blog-platform\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:\\\\Users\\\\stalk\\\\jm-blog-platform\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\stalk\\\\jm-blog-platform\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import React,{useEffect}from'react';import{uniqueId}from'lodash';import{connect}from'react-redux';import{useFormik}from'formik';import{useHistory}from'react-router';import{Button,Input}from'antd';import*as Yup from'yup';import{useParams}from'react-router-dom';import{mainUrl}from'../../routes';import{renderErrorMessage,renderLoader}from'../../helper';import'antd/dist/antd.css';import*as actions from'../../redux/actions/articles';import{FormItem,FormArticle,FormTitle,FormItemTagsWrap,FormAddTagButton,FormRemoveTagButton,FormItemTagsTitle,FormItemTag}from'../../styled-components';var formSubmitButtonStyles={height:40,maxWidth:320,width:'100%'};var formAddTagInputStyles={maxWidth:300,width:'100%',borderRadius:4};var markdownStyles={flexGrow:1};var formItems=[{id:uniqueId(),title:'Title',name:'title',placeholder:'Title',type:'text'},{id:uniqueId(),title:'Short description',name:'description',placeholder:'Description',type:'text'}];var formikInicialValues={title:'',description:'',body:'',tagText:'',tagList:[]};var formikValidationSchema=Yup.object({title:Yup.string().required('required'),description:Yup.string().required('required'),body:Yup.string().required('required')});var mapStateToProps=function mapStateToProps(state){var userData=state.userData,oneArticle=state.oneArticle,oneArticleState=state.oneArticleState,editArticleState=state.editArticleState;return{username:userData.username,isOneArticleReady:oneArticleState==='finished',isArticleChanged:editArticleState==='finished',isInputsDisabled:editArticleState==='requested',oneArticle:oneArticle};};var actionCreators={editArticle:actions.editArticle,getOneArticle:actions.getOneArticle};var EditArticle=function EditArticle(props){var isArticleChanged=props.isArticleChanged,username=props.username,getOneArticle=props.getOneArticle,oneArticle=props.oneArticle,isOneArticleReady=props.isOneArticleReady,isInputsDisabled=props.isInputsDisabled;var _useParams=useParams(),slug=_useParams.slug;var queryParam=slug.slice(1,slug.length);var handleOnEditArticle=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(formik){var editArticle,_formik$values,title,description,body,tagList,tags,articleBody;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:editArticle=props.editArticle;_formik$values=formik.values,title=_formik$values.title,description=_formik$values.description,body=_formik$values.body,tagList=_formik$values.tagList;tags=tagList.map(function(tag){return tag.title;});articleBody={article:{title:title,description:description,body:body,tagList:tags}};editArticle(articleBody,queryParam,formik);case 5:case\"end\":return _context.stop();}}},_callee);}));return function handleOnEditArticle(_x){return _ref.apply(this,arguments);};}();var history=useHistory();var redirectToHome=function redirectToHome(){history.push(mainUrl);};var formik=useFormik({initialValues:formikInicialValues,validationSchema:formikValidationSchema,onSubmit:function onSubmit(){handleOnEditArticle(formik);}});var setFormikValues=function setFormikValues(article){if(!isOneArticleReady)return false;var author=article.author,description=article.description,tagList=article.tagList,title=article.title,body=article.body;var isCurrentUserAuthor=username===author.username;if(!isCurrentUserAuthor)redirectToHome();formik.setFieldValue('title',title);formik.setFieldValue('description',description);formik.setFieldValue('body',body);formik.setFieldValue('tagList',tagList);return true;};useEffect(function(){// запросить у сервера дату этого поста\nif(!isOneArticleReady)getOneArticle(queryParam);// изменить данные поста\nif(isOneArticleReady)setFormikValues(oneArticle);// редирект после изменения\nif(isArticleChanged){redirectToHome();}},[oneArticle,isArticleChanged]);var handleOnAddTag=function handleOnAddTag(){var _formik$values2=formik.values,tagText=_formik$values2.tagText,tagList=_formik$values2.tagList;if(tagText.trim().length===0){formik.setFieldValue('tagText','');return;}var initialNewTag={id:uniqueId(),title:tagText};var newTagsArray=[].concat(_toConsumableArray(tagList),[initialNewTag]);formik.setFieldValue('tagList',newTagsArray);formik.setFieldValue('tagText','');};var handleOnRemoveTag=function handleOnRemoveTag(id){return function(){var tagList=formik.values.tagList;var newTagsArray=tagList.filter(function(tag){return tag.id!==id;});formik.setFieldValue('tagList',newTagsArray);};};var handleOnClearTagInput=function handleOnClearTagInput(){formik.setFieldValue('tagText','');};var renderTags=function renderTags(){var tagList=formik.values.tagList;if(tagList.length===0)return null;return tagList.map(function(tag){var id=tag.id,title=tag.title;return/*#__PURE__*/React.createElement(FormItemTag,{key:id},/*#__PURE__*/React.createElement(Input,{style:formAddTagInputStyles,onChange:formik.handleChange,value:title,disabled:isInputsDisabled}),/*#__PURE__*/React.createElement(FormRemoveTagButton,{onClick:handleOnRemoveTag(id)},\"Delete\"));});};var renderInputs=function renderInputs(){return formItems.map(function(formItem){return/*#__PURE__*/React.createElement(FormItem,{key:formItem.id,htmlFor:formItem.name},formItem.title,/*#__PURE__*/React.createElement(Input,{type:formItem.type,placeholder:formItem.placeholder,id:formItem.name,name:formItem.name,onChange:formik.handleChange,value:formik.values[formItem.name],disabled:isInputsDisabled}),renderErrorMessage(formik,formItem.name));});};var renderForm=function renderForm(){return/*#__PURE__*/React.createElement(FormArticle,{onSubmit:formik.handleSubmit},/*#__PURE__*/React.createElement(FormTitle,null,\"Edit Article\"),renderInputs(),/*#__PURE__*/React.createElement(FormItem,{htmlFor:\"body\",style:markdownStyles},\"Text\",/*#__PURE__*/React.createElement(Input.TextArea,{name:\"body\",id:\"body\",onChange:formik.handleChange,value:formik.values.body,rows:8,disabled:isInputsDisabled,allowClear:true}),renderErrorMessage(formik,'body')),/*#__PURE__*/React.createElement(FormItemTagsWrap,null,/*#__PURE__*/React.createElement(FormItemTagsTitle,null,\"Tags\"),renderTags(),/*#__PURE__*/React.createElement(FormItemTag,null,/*#__PURE__*/React.createElement(Input,{name:\"tagText\",id:\"tagText\",placeholder:\"write tag\",style:formAddTagInputStyles,onChange:formik.handleChange,value:formik.values.tagText,disabled:isInputsDisabled}),/*#__PURE__*/React.createElement(FormRemoveTagButton,{onClick:handleOnClearTagInput},\"Delete\"),/*#__PURE__*/React.createElement(FormAddTagButton,{onClick:handleOnAddTag},\"Add tag\"))),/*#__PURE__*/React.createElement(Button,{htmlType:\"submit\",type:\"primary\",onClick:formik.handleSubmit,style:formSubmitButtonStyles,disabled:isInputsDisabled},\"Send\"));};return!isOneArticleReady?renderLoader():renderForm();};EditArticle.defaultProps={isArticleChanged:false,username:null,getOneArticle:null,oneArticle:{},isOneArticleReady:false,editArticle:null};export default connect(mapStateToProps,actionCreators)(EditArticle);","map":{"version":3,"sources":["C:/Users/stalk/jm-blog-platform/src/components/edit-article/index.js"],"names":["React","useEffect","uniqueId","connect","useFormik","useHistory","Button","Input","Yup","useParams","mainUrl","renderErrorMessage","renderLoader","actions","FormItem","FormArticle","FormTitle","FormItemTagsWrap","FormAddTagButton","FormRemoveTagButton","FormItemTagsTitle","FormItemTag","formSubmitButtonStyles","height","maxWidth","width","formAddTagInputStyles","borderRadius","markdownStyles","flexGrow","formItems","id","title","name","placeholder","type","formikInicialValues","description","body","tagText","tagList","formikValidationSchema","object","string","required","mapStateToProps","state","userData","oneArticle","oneArticleState","editArticleState","username","isOneArticleReady","isArticleChanged","isInputsDisabled","actionCreators","editArticle","getOneArticle","EditArticle","props","slug","queryParam","slice","length","handleOnEditArticle","formik","values","tags","map","tag","articleBody","article","history","redirectToHome","push","initialValues","validationSchema","onSubmit","setFormikValues","author","isCurrentUserAuthor","setFieldValue","handleOnAddTag","trim","initialNewTag","newTagsArray","handleOnRemoveTag","filter","handleOnClearTagInput","renderTags","handleChange","renderInputs","formItem","renderForm","handleSubmit","defaultProps"],"mappings":"+dAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,QAAT,KAAyB,QAAzB,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAASC,SAAT,KAA0B,QAA1B,CACA,OAASC,UAAT,KAA2B,cAA3B,CACA,OAASC,MAAT,CAAiBC,KAAjB,KAA8B,MAA9B,CAEA,MAAO,GAAKC,CAAAA,GAAZ,KAAqB,KAArB,CACA,OAASC,SAAT,KAA0B,kBAA1B,CACA,OAASC,OAAT,KAAwB,cAAxB,CACA,OAASC,kBAAT,CAA6BC,YAA7B,KAAiD,cAAjD,CACA,MAAO,oBAAP,CACA,MAAO,GAAKC,CAAAA,OAAZ,KAAyB,8BAAzB,CAEA,OACEC,QADF,CAEEC,WAFF,CAGEC,SAHF,CAIEC,gBAJF,CAKEC,gBALF,CAMEC,mBANF,CAOEC,iBAPF,CAQEC,WARF,KASO,yBATP,CAWA,GAAMC,CAAAA,sBAAsB,CAAG,CAC7BC,MAAM,CAAE,EADqB,CAE7BC,QAAQ,CAAE,GAFmB,CAG7BC,KAAK,CAAE,MAHsB,CAA/B,CAMA,GAAMC,CAAAA,qBAAqB,CAAG,CAC5BF,QAAQ,CAAE,GADkB,CAE5BC,KAAK,CAAE,MAFqB,CAG5BE,YAAY,CAAE,CAHc,CAA9B,CAMA,GAAMC,CAAAA,cAAc,CAAG,CACrBC,QAAQ,CAAE,CADW,CAAvB,CAIA,GAAMC,CAAAA,SAAS,CAAG,CAChB,CACEC,EAAE,CAAE7B,QAAQ,EADd,CACkB8B,KAAK,CAAE,OADzB,CACkCC,IAAI,CAAE,OADxC,CACiDC,WAAW,CAAE,OAD9D,CACuEC,IAAI,CAAE,MAD7E,CADgB,CAIhB,CACEJ,EAAE,CAAE7B,QAAQ,EADd,CACkB8B,KAAK,CAAE,mBADzB,CAC8CC,IAAI,CAAE,aADpD,CACmEC,WAAW,CAAE,aADhF,CAC+FC,IAAI,CAAE,MADrG,CAJgB,CAAlB,CASA,GAAMC,CAAAA,mBAAmB,CAAG,CAC1BJ,KAAK,CAAE,EADmB,CAE1BK,WAAW,CAAE,EAFa,CAG1BC,IAAI,CAAE,EAHoB,CAI1BC,OAAO,CAAE,EAJiB,CAK1BC,OAAO,CAAE,EALiB,CAA5B,CAQA,GAAMC,CAAAA,sBAAsB,CAAGjC,GAAG,CAACkC,MAAJ,CAAW,CACxCV,KAAK,CAAExB,GAAG,CAACmC,MAAJ,GACJC,QADI,CACK,UADL,CADiC,CAGxCP,WAAW,CAAE7B,GAAG,CAACmC,MAAJ,GACVC,QADU,CACD,UADC,CAH2B,CAKxCN,IAAI,CAAE9B,GAAG,CAACmC,MAAJ,GACHC,QADG,CACM,UADN,CALkC,CAAX,CAA/B,CASA,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACC,KAAD,CAAW,IAE/BC,CAAAA,QAF+B,CAG7BD,KAH6B,CAE/BC,QAF+B,CAErBC,UAFqB,CAG7BF,KAH6B,CAErBE,UAFqB,CAETC,eAFS,CAG7BH,KAH6B,CAETG,eAFS,CAEQC,gBAFR,CAG7BJ,KAH6B,CAEQI,gBAFR,CAKjC,MAAO,CACLC,QAAQ,CAAEJ,QAAQ,CAACI,QADd,CAELC,iBAAiB,CAAEH,eAAe,GAAK,UAFlC,CAGLI,gBAAgB,CAAEH,gBAAgB,GAAK,UAHlC,CAILI,gBAAgB,CAAEJ,gBAAgB,GAAK,WAJlC,CAKLF,UAAU,CAAVA,UALK,CAAP,CAOD,CAZD,CAcA,GAAMO,CAAAA,cAAc,CAAG,CACrBC,WAAW,CAAE3C,OAAO,CAAC2C,WADA,CAErBC,aAAa,CAAE5C,OAAO,CAAC4C,aAFF,CAAvB,CAKA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,KAAD,CAAW,IAE3BN,CAAAA,gBAF2B,CAGzBM,KAHyB,CAE3BN,gBAF2B,CAETF,QAFS,CAGzBQ,KAHyB,CAETR,QAFS,CAECM,aAFD,CAGzBE,KAHyB,CAECF,aAFD,CAEgBT,UAFhB,CAGzBW,KAHyB,CAEgBX,UAFhB,CAE4BI,iBAF5B,CAGzBO,KAHyB,CAE4BP,iBAF5B,CAE+CE,gBAF/C,CAGzBK,KAHyB,CAE+CL,gBAF/C,gBAIZ7C,SAAS,EAJG,CAIrBmD,IAJqB,YAIrBA,IAJqB,CAK7B,GAAMC,CAAAA,UAAU,CAAGD,IAAI,CAACE,KAAL,CAAW,CAAX,CAAcF,IAAI,CAACG,MAAnB,CAAnB,CAEA,GAAMC,CAAAA,mBAAmB,0FAAG,iBAAOC,MAAP,iMAClBT,WADkB,CACFG,KADE,CAClBH,WADkB,gBAItBS,MAAM,CAACC,MAJe,CAGxBlC,KAHwB,gBAGxBA,KAHwB,CAGjBK,WAHiB,gBAGjBA,WAHiB,CAGJC,IAHI,gBAGJA,IAHI,CAGEE,OAHF,gBAGEA,OAHF,CAKpB2B,IALoB,CAKb3B,OAAO,CAAC4B,GAAR,CAAY,SAACC,GAAD,QAASA,CAAAA,GAAG,CAACrC,KAAb,EAAZ,CALa,CAOpBsC,WAPoB,CAON,CAClBC,OAAO,CAAE,CACPvC,KAAK,CAALA,KADO,CACAK,WAAW,CAAXA,WADA,CACaC,IAAI,CAAJA,IADb,CACmBE,OAAO,CAAE2B,IAD5B,CADS,CAPM,CAY1BX,WAAW,CAACc,WAAD,CAAcT,UAAd,CAA0BI,MAA1B,CAAX,CAZ0B,sDAAH,kBAAnBD,CAAAA,mBAAmB,4CAAzB,CAeA,GAAMQ,CAAAA,OAAO,CAAGnE,UAAU,EAA1B,CACA,GAAMoE,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,CAC3BD,OAAO,CAACE,IAAR,CAAahE,OAAb,EACD,CAFD,CAIA,GAAMuD,CAAAA,MAAM,CAAG7D,SAAS,CAAC,CACvBuE,aAAa,CAAEvC,mBADQ,CAEvBwC,gBAAgB,CAAEnC,sBAFK,CAGvBoC,QAAQ,CAAE,mBAAM,CACdb,mBAAmB,CAACC,MAAD,CAAnB,CACD,CALsB,CAAD,CAAxB,CAQA,GAAMa,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACP,OAAD,CAAa,CACnC,GAAI,CAACnB,iBAAL,CAAwB,MAAO,MAAP,CADW,GAIjC2B,CAAAA,MAJiC,CAK/BR,OAL+B,CAIjCQ,MAJiC,CAIzB1C,WAJyB,CAK/BkC,OAL+B,CAIzBlC,WAJyB,CAIZG,OAJY,CAK/B+B,OAL+B,CAIZ/B,OAJY,CAIHR,KAJG,CAK/BuC,OAL+B,CAIHvC,KAJG,CAIIM,IAJJ,CAK/BiC,OAL+B,CAIIjC,IAJJ,CAOnC,GAAM0C,CAAAA,mBAAmB,CAAI7B,QAAQ,GAAK4B,MAAM,CAAC5B,QAAjD,CACA,GAAI,CAAC6B,mBAAL,CAA0BP,cAAc,GACxCR,MAAM,CAACgB,aAAP,CAAqB,OAArB,CAA8BjD,KAA9B,EACAiC,MAAM,CAACgB,aAAP,CAAqB,aAArB,CAAoC5C,WAApC,EACA4B,MAAM,CAACgB,aAAP,CAAqB,MAArB,CAA6B3C,IAA7B,EACA2B,MAAM,CAACgB,aAAP,CAAqB,SAArB,CAAgCzC,OAAhC,EACA,MAAO,KAAP,CACD,CAdD,CAgBAvC,SAAS,CAAC,UAAM,CACd;AACA,GAAI,CAACmD,iBAAL,CAAwBK,aAAa,CAACI,UAAD,CAAb,CAExB;AACA,GAAIT,iBAAJ,CAAuB0B,eAAe,CAAC9B,UAAD,CAAf,CAEvB;AACA,GAAIK,gBAAJ,CAAsB,CACpBoB,cAAc,GACf,CACF,CAXQ,CAWN,CAACzB,UAAD,CAAaK,gBAAb,CAXM,CAAT,CAaA,GAAM6B,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,qBACEjB,MAAM,CAACC,MADT,CACnB3B,OADmB,iBACnBA,OADmB,CACVC,OADU,iBACVA,OADU,CAE3B,GAAID,OAAO,CAAC4C,IAAR,GAAepB,MAAf,GAA0B,CAA9B,CAAiC,CAC/BE,MAAM,CAACgB,aAAP,CAAqB,SAArB,CAAgC,EAAhC,EACA,OACD,CAED,GAAMG,CAAAA,aAAa,CAAG,CACpBrD,EAAE,CAAE7B,QAAQ,EADQ,CAEpB8B,KAAK,CAAEO,OAFa,CAAtB,CAKA,GAAM8C,CAAAA,YAAY,8BAAO7C,OAAP,GAAgB4C,aAAhB,EAAlB,CACAnB,MAAM,CAACgB,aAAP,CAAqB,SAArB,CAAgCI,YAAhC,EACApB,MAAM,CAACgB,aAAP,CAAqB,SAArB,CAAgC,EAAhC,EACD,CAfD,CAiBA,GAAMK,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACvD,EAAD,QAAQ,WAAM,IAC9BS,CAAAA,OAD8B,CAClByB,MAAM,CAACC,MADW,CAC9B1B,OAD8B,CAGtC,GAAM6C,CAAAA,YAAY,CAAG7C,OAAO,CAAC+C,MAAR,CAAe,SAAClB,GAAD,QAASA,CAAAA,GAAG,CAACtC,EAAJ,GAAWA,EAApB,EAAf,CAArB,CAEAkC,MAAM,CAACgB,aAAP,CAAqB,SAArB,CAAgCI,YAAhC,EACD,CANyB,EAA1B,CAQA,GAAMG,CAAAA,qBAAqB,CAAG,QAAxBA,CAAAA,qBAAwB,EAAM,CAClCvB,MAAM,CAACgB,aAAP,CAAqB,SAArB,CAAgC,EAAhC,EACD,CAFD,CAIA,GAAMQ,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,IACfjD,CAAAA,OADe,CACHyB,MAAM,CAACC,MADJ,CACf1B,OADe,CAEvB,GAAIA,OAAO,CAACuB,MAAR,GAAmB,CAAvB,CAA0B,MAAO,KAAP,CAE1B,MAAOvB,CAAAA,OAAO,CAAC4B,GAAR,CAAY,SAACC,GAAD,CAAS,IAClBtC,CAAAA,EADkB,CACJsC,GADI,CAClBtC,EADkB,CACdC,KADc,CACJqC,GADI,CACdrC,KADc,CAG1B,mBACE,oBAAC,WAAD,EAAa,GAAG,CAAED,EAAlB,eACE,oBAAC,KAAD,EACE,KAAK,CAAEL,qBADT,CAEE,QAAQ,CAAEuC,MAAM,CAACyB,YAFnB,CAGE,KAAK,CAAE1D,KAHT,CAIE,QAAQ,CAAEsB,gBAJZ,EADF,cAOE,oBAAC,mBAAD,EAAqB,OAAO,CAAEgC,iBAAiB,CAACvD,EAAD,CAA/C,WAPF,CADF,CAWD,CAdM,CAAP,CAeD,CAnBD,CAqBA,GAAM4D,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,SACnB7D,CAAAA,SAAS,CAACsC,GAAV,CAAc,SAACwB,QAAD,qBACZ,oBAAC,QAAD,EAAU,GAAG,CAAEA,QAAQ,CAAC7D,EAAxB,CAA4B,OAAO,CAAE6D,QAAQ,CAAC3D,IAA9C,EACG2D,QAAQ,CAAC5D,KADZ,cAEE,oBAAC,KAAD,EACE,IAAI,CAAE4D,QAAQ,CAACzD,IADjB,CAEE,WAAW,CAAEyD,QAAQ,CAAC1D,WAFxB,CAGE,EAAE,CAAE0D,QAAQ,CAAC3D,IAHf,CAIE,IAAI,CAAE2D,QAAQ,CAAC3D,IAJjB,CAKE,QAAQ,CAAEgC,MAAM,CAACyB,YALnB,CAME,KAAK,CAAEzB,MAAM,CAACC,MAAP,CAAc0B,QAAQ,CAAC3D,IAAvB,CANT,CAOE,QAAQ,CAAEqB,gBAPZ,EAFF,CAWG3C,kBAAkB,CAACsD,MAAD,CAAS2B,QAAQ,CAAC3D,IAAlB,CAXrB,CADY,EAAd,CADmB,EAArB,CAkBA,GAAM4D,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,sBACjB,oBAAC,WAAD,EAAa,QAAQ,CAAE5B,MAAM,CAAC6B,YAA9B,eACE,oBAAC,SAAD,qBADF,CAGGH,YAAY,EAHf,cAKE,oBAAC,QAAD,EAAU,OAAO,CAAC,MAAlB,CAAyB,KAAK,CAAE/D,cAAhC,sBAEE,oBAAC,KAAD,CAAO,QAAP,EACE,IAAI,CAAC,MADP,CAEE,EAAE,CAAC,MAFL,CAGE,QAAQ,CAAEqC,MAAM,CAACyB,YAHnB,CAIE,KAAK,CAAEzB,MAAM,CAACC,MAAP,CAAc5B,IAJvB,CAKE,IAAI,CAAE,CALR,CAME,QAAQ,CAAEgB,gBANZ,CAOE,UAAU,KAPZ,EAFF,CAWG3C,kBAAkB,CAACsD,MAAD,CAAS,MAAT,CAXrB,CALF,cAmBE,oBAAC,gBAAD,mBACE,oBAAC,iBAAD,aADF,CAEGwB,UAAU,EAFb,cAGE,oBAAC,WAAD,mBACE,oBAAC,KAAD,EACE,IAAI,CAAC,SADP,CAEE,EAAE,CAAC,SAFL,CAGE,WAAW,CAAC,WAHd,CAIE,KAAK,CAAE/D,qBAJT,CAKE,QAAQ,CAAEuC,MAAM,CAACyB,YALnB,CAME,KAAK,CAAEzB,MAAM,CAACC,MAAP,CAAc3B,OANvB,CAOE,QAAQ,CAAEe,gBAPZ,EADF,cAUE,oBAAC,mBAAD,EAAqB,OAAO,CAAEkC,qBAA9B,WAVF,cAWE,oBAAC,gBAAD,EAAkB,OAAO,CAAEN,cAA3B,YAXF,CAHF,CAnBF,cAqCE,oBAAC,MAAD,EACE,QAAQ,CAAC,QADX,CAEE,IAAI,CAAC,SAFP,CAGE,OAAO,CAAEjB,MAAM,CAAC6B,YAHlB,CAIE,KAAK,CAAExE,sBAJT,CAKE,QAAQ,CAAEgC,gBALZ,SArCF,CADiB,EAAnB,CAkDA,MAAQ,CAACF,iBAAF,CAAuBxC,YAAY,EAAnC,CAAwCiF,UAAU,EAAzD,CACD,CAvLD,CAkMAnC,WAAW,CAACqC,YAAZ,CAA2B,CACzB1C,gBAAgB,CAAE,KADO,CAEzBF,QAAQ,CAAE,IAFe,CAGzBM,aAAa,CAAE,IAHU,CAIzBT,UAAU,CAAE,EAJa,CAKzBI,iBAAiB,CAAE,KALM,CAMzBI,WAAW,CAAE,IANY,CAA3B,CASA,cAAerD,CAAAA,OAAO,CAAC0C,eAAD,CAAkBU,cAAlB,CAAP,CAAyCG,WAAzC,CAAf","sourcesContent":["import React, { useEffect } from 'react';\nimport { uniqueId } from 'lodash';\nimport { connect } from 'react-redux';\nimport { useFormik } from 'formik';\nimport { useHistory } from 'react-router';\nimport { Button, Input } from 'antd';\nimport propTypes from 'prop-types';\nimport * as Yup from 'yup';\nimport { useParams } from 'react-router-dom';\nimport { mainUrl } from '../../routes';\nimport { renderErrorMessage, renderLoader } from '../../helper';\nimport 'antd/dist/antd.css';\nimport * as actions from '../../redux/actions/articles';\n\nimport {\n  FormItem,\n  FormArticle,\n  FormTitle,\n  FormItemTagsWrap,\n  FormAddTagButton,\n  FormRemoveTagButton,\n  FormItemTagsTitle,\n  FormItemTag,\n} from '../../styled-components';\n\nconst formSubmitButtonStyles = {\n  height: 40,\n  maxWidth: 320,\n  width: '100%',\n};\n\nconst formAddTagInputStyles = {\n  maxWidth: 300,\n  width: '100%',\n  borderRadius: 4,\n};\n\nconst markdownStyles = {\n  flexGrow: 1,\n};\n\nconst formItems = [\n  {\n    id: uniqueId(), title: 'Title', name: 'title', placeholder: 'Title', type: 'text',\n  },\n  {\n    id: uniqueId(), title: 'Short description', name: 'description', placeholder: 'Description', type: 'text',\n  },\n];\n\nconst formikInicialValues = {\n  title: '',\n  description: '',\n  body: '',\n  tagText: '',\n  tagList: [],\n};\n\nconst formikValidationSchema = Yup.object({\n  title: Yup.string()\n    .required('required'),\n  description: Yup.string()\n    .required('required'),\n  body: Yup.string()\n    .required('required'),\n});\n\nconst mapStateToProps = (state) => {\n  const {\n    userData, oneArticle, oneArticleState, editArticleState,\n  } = state;\n\n  return {\n    username: userData.username,\n    isOneArticleReady: oneArticleState === 'finished',\n    isArticleChanged: editArticleState === 'finished',\n    isInputsDisabled: editArticleState === 'requested',\n    oneArticle,\n  };\n};\n\nconst actionCreators = {\n  editArticle: actions.editArticle,\n  getOneArticle: actions.getOneArticle,\n};\n\nconst EditArticle = (props) => {\n  const {\n    isArticleChanged, username, getOneArticle, oneArticle, isOneArticleReady, isInputsDisabled,\n  } = props;\n  const { slug } = useParams();\n  const queryParam = slug.slice(1, slug.length);\n\n  const handleOnEditArticle = async (formik) => {\n    const { editArticle } = props;\n    const {\n      title, description, body, tagList,\n    } = formik.values;\n    const tags = tagList.map((tag) => tag.title);\n\n    const articleBody = {\n      article: {\n        title, description, body, tagList: tags,\n      },\n    };\n    editArticle(articleBody, queryParam, formik);\n  };\n\n  const history = useHistory();\n  const redirectToHome = () => {\n    history.push(mainUrl);\n  };\n\n  const formik = useFormik({\n    initialValues: formikInicialValues,\n    validationSchema: formikValidationSchema,\n    onSubmit: () => {\n      handleOnEditArticle(formik);\n    },\n  });\n\n  const setFormikValues = (article) => {\n    if (!isOneArticleReady) return false;\n\n    const {\n      author, description, tagList, title, body,\n    } = article;\n\n    const isCurrentUserAuthor = (username === author.username);\n    if (!isCurrentUserAuthor) redirectToHome();\n    formik.setFieldValue('title', title);\n    formik.setFieldValue('description', description);\n    formik.setFieldValue('body', body);\n    formik.setFieldValue('tagList', tagList);\n    return true;\n  };\n\n  useEffect(() => {\n    // запросить у сервера дату этого поста\n    if (!isOneArticleReady) getOneArticle(queryParam);\n\n    // изменить данные поста\n    if (isOneArticleReady) setFormikValues(oneArticle);\n\n    // редирект после изменения\n    if (isArticleChanged) {\n      redirectToHome();\n    }\n  }, [oneArticle, isArticleChanged]);\n\n  const handleOnAddTag = () => {\n    const { tagText, tagList } = formik.values;\n    if (tagText.trim().length === 0) {\n      formik.setFieldValue('tagText', '');\n      return;\n    }\n\n    const initialNewTag = {\n      id: uniqueId(),\n      title: tagText,\n    };\n\n    const newTagsArray = [...tagList, initialNewTag];\n    formik.setFieldValue('tagList', newTagsArray);\n    formik.setFieldValue('tagText', '');\n  };\n\n  const handleOnRemoveTag = (id) => () => {\n    const { tagList } = formik.values;\n\n    const newTagsArray = tagList.filter((tag) => tag.id !== id);\n\n    formik.setFieldValue('tagList', newTagsArray);\n  };\n\n  const handleOnClearTagInput = () => {\n    formik.setFieldValue('tagText', '');\n  };\n\n  const renderTags = () => {\n    const { tagList } = formik.values;\n    if (tagList.length === 0) return null;\n\n    return tagList.map((tag) => {\n      const { id, title } = tag;\n\n      return (\n        <FormItemTag key={id}>\n          <Input\n            style={formAddTagInputStyles}\n            onChange={formik.handleChange}\n            value={title}\n            disabled={isInputsDisabled}\n          />\n          <FormRemoveTagButton onClick={handleOnRemoveTag(id)}>Delete</FormRemoveTagButton>\n        </FormItemTag>\n      );\n    });\n  };\n\n  const renderInputs = () => (\n    formItems.map((formItem) => (\n      <FormItem key={formItem.id} htmlFor={formItem.name}>\n        {formItem.title}\n        <Input\n          type={formItem.type}\n          placeholder={formItem.placeholder}\n          id={formItem.name}\n          name={formItem.name}\n          onChange={formik.handleChange}\n          value={formik.values[formItem.name]}\n          disabled={isInputsDisabled}\n        />\n        {renderErrorMessage(formik, formItem.name)}\n      </FormItem>\n    ))\n  );\n\n  const renderForm = () => (\n    <FormArticle onSubmit={formik.handleSubmit}>\n      <FormTitle>Edit Article</FormTitle>\n\n      {renderInputs()}\n\n      <FormItem htmlFor=\"body\" style={markdownStyles}>\n        Text\n        <Input.TextArea\n          name=\"body\"\n          id=\"body\"\n          onChange={formik.handleChange}\n          value={formik.values.body}\n          rows={8}\n          disabled={isInputsDisabled}\n          allowClear\n        />\n        {renderErrorMessage(formik, 'body')}\n      </FormItem>\n\n      <FormItemTagsWrap>\n        <FormItemTagsTitle>Tags</FormItemTagsTitle>\n        {renderTags()}\n        <FormItemTag>\n          <Input\n            name=\"tagText\"\n            id=\"tagText\"\n            placeholder=\"write tag\"\n            style={formAddTagInputStyles}\n            onChange={formik.handleChange}\n            value={formik.values.tagText}\n            disabled={isInputsDisabled}\n          />\n          <FormRemoveTagButton onClick={handleOnClearTagInput}>Delete</FormRemoveTagButton>\n          <FormAddTagButton onClick={handleOnAddTag}>Add tag</FormAddTagButton>\n        </FormItemTag>\n      </FormItemTagsWrap>\n\n      <Button\n        htmlType=\"submit\"\n        type=\"primary\"\n        onClick={formik.handleSubmit}\n        style={formSubmitButtonStyles}\n        disabled={isInputsDisabled}\n      >\n        Send\n      </Button>\n    </FormArticle>\n  );\n\n  return (!isOneArticleReady) ? renderLoader() : renderForm();\n};\n\nEditArticle.propTypes = {\n  isArticleChanged: propTypes.bool,\n  username: propTypes.string,\n  getOneArticle: propTypes.func,\n  oneArticle: propTypes.objectOf(propTypes.object),\n  isOneArticleReady: propTypes.bool,\n  editArticle: propTypes.func,\n};\n\nEditArticle.defaultProps = {\n  isArticleChanged: false,\n  username: null,\n  getOneArticle: null,\n  oneArticle: {},\n  isOneArticleReady: false,\n  editArticle: null,\n};\n\nexport default connect(mapStateToProps, actionCreators)(EditArticle);\n"]},"metadata":{},"sourceType":"module"}